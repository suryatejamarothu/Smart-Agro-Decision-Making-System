{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">Government Schemes for Farmers</h3>
            </div>
            <div class="card-body">
                <p class="lead">Check your eligibility for various government schemes by filling the form below.</p>
                
                {% if error %}
                <div class="alert alert-danger">{{ error }}</div>
                {% endif %}
                
                <form method="POST" action="{{ url_for('schemes') }}" class="needs-validation" novalidate>
                    {{ form.hidden_tag() }}
                    
                    <h5 class="mt-4 text-success">Personal Information</h5>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.name.label(class="form-label") }}
                                {{ form.name(class="form-control" + (' is-invalid' if form.name.errors else '')) }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.name.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                {{ form.age.label(class="form-label") }}
                                {{ form.age(class="form-control" + (' is-invalid' if form.age.errors else '')) }}
                                {% if form.age.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.age.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                {{ form.gender.label(class="form-label") }}
                                {{ form.gender(class="form-select" + (' is-invalid' if form.gender.errors else '')) }}
                                {% if form.gender.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.gender.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mt-4 text-success">Location Details</h5>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">State *</label>
                                <select class="form-select" name="state" id="state" required>
                                    <option value="" disabled selected>Select State</option>
                                    <option value="Andhra Pradesh" {% if form.state.data == 'Andhra Pradesh' %}selected{% endif %}>Andhra Pradesh</option>
                                    <option value="Arunachal Pradesh" {% if form.state.data == 'Arunachal Pradesh' %}selected{% endif %}>Arunachal Pradesh</option>
                                    <option value="Assam" {% if form.state.data == 'Assam' %}selected{% endif %}>Assam</option>
                                    <option value="Bihar" {% if form.state.data == 'Bihar' %}selected{% endif %}>Bihar</option>
                                    <option value="Chhattisgarh" {% if form.state.data == 'Chhattisgarh' %}selected{% endif %}>Chhattisgarh</option>
                                    <option value="Goa" {% if form.state.data == 'Goa' %}selected{% endif %}>Goa</option>
                                    <option value="Gujarat" {% if form.state.data == 'Gujarat' %}selected{% endif %}>Gujarat</option>
                                    <option value="Haryana" {% if form.state.data == 'Haryana' %}selected{% endif %}>Haryana</option>
                                    <option value="Himachal Pradesh" {% if form.state.data == 'Himachal Pradesh' %}selected{% endif %}>Himachal Pradesh</option>
                                    <option value="Jharkhand" {% if form.state.data == 'Jharkhand' %}selected{% endif %}>Jharkhand</option>
                                    <option value="Karnataka" {% if form.state.data == 'Karnataka' %}selected{% endif %}>Karnataka</option>
                                    <option value="Kerala" {% if form.state.data == 'Kerala' %}selected{% endif %}>Kerala</option>
                                    <option value="Madhya Pradesh" {% if form.state.data == 'Madhya Pradesh' %}selected{% endif %}>Madhya Pradesh</option>
                                    <option value="Maharashtra" {% if form.state.data == 'Maharashtra' %}selected{% endif %}>Maharashtra</option>
                                    <option value="Manipur" {% if form.state.data == 'Manipur' %}selected{% endif %}>Manipur</option>
                                    <option value="Meghalaya" {% if form.state.data == 'Meghalaya' %}selected{% endif %}>Meghalaya</option>
                                    <option value="Mizoram" {% if form.state.data == 'Mizoram' %}selected{% endif %}>Mizoram</option>
                                    <option value="Nagaland" {% if form.state.data == 'Nagaland' %}selected{% endif %}>Nagaland</option>
                                    <option value="Odisha" {% if form.state.data == 'Odisha' %}selected{% endif %}>Odisha</option>
                                    <option value="Punjab" {% if form.state.data == 'Punjab' %}selected{% endif %}>Punjab</option>
                                    <option value="Rajasthan" {% if form.state.data == 'Rajasthan' %}selected{% endif %}>Rajasthan</option>
                                    <option value="Sikkim" {% if form.state.data == 'Sikkim' %}selected{% endif %}>Sikkim</option>
                                    <option value="Tamil Nadu" {% if form.state.data == 'Tamil Nadu' %}selected{% endif %}>Tamil Nadu</option>
                                    <option value="Telangana" {% if form.state.data == 'Telangana' %}selected{% endif %}>Telangana</option>
                                    <option value="Tripura" {% if form.state.data == 'Tripura' %}selected{% endif %}>Tripura</option>
                                    <option value="Uttar Pradesh" {% if form.state.data == 'Uttar Pradesh' %}selected{% endif %}>Uttar Pradesh</option>
                                    <option value="Uttarakhand" {% if form.state.data == 'Uttarakhand' %}selected{% endif %}>Uttarakhand</option>
                                    <option value="West Bengal" {% if form.state.data == 'West Bengal' %}selected{% endif %}>West Bengal</option>
                                    <option value="Andaman and Nicobar Islands" {% if form.state.data == 'Andaman and Nicobar Islands' %}selected{% endif %}>Andaman and Nicobar Islands</option>
                                    <option value="Chandigarh" {% if form.state.data == 'Chandigarh' %}selected{% endif %}>Chandigarh</option>
                                    <option value="Dadra and Nagar Haveli and Daman and Diu" {% if form.state.data == 'Dadra and Nagar Haveli and Daman and Diu' %}selected{% endif %}>Dadra and Nagar Haveli and Daman and Diu</option>
                                    <option value="Delhi" {% if form.state.data == 'Delhi' %}selected{% endif %}>Delhi</option>
                                    <option value="Jammu and Kashmir" {% if form.state.data == 'Jammu and Kashmir' %}selected{% endif %}>Jammu and Kashmir</option>
                                    <option value="Ladakh" {% if form.state.data == 'Ladakh' %}selected{% endif %}>Ladakh</option>
                                    <option value="Lakshadweep" {% if form.state.data == 'Lakshadweep' %}selected{% endif %}>Lakshadweep</option>
                                    <option value="Puducherry" {% if form.state.data == 'Puducherry' %}selected{% endif %}>Puducherry</option>
                                </select>
                                {% if form.state.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.state.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.district.label(class="form-label") }}
                                {{ form.district(class="form-control" + (' is-invalid' if form.district.errors else '')) }}
                                {% if form.district.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.district.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mt-4 text-success">Land & Income Details</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                {{ form.land_ownership.label(class="form-label") }}
                                {{ form.land_ownership(class="form-select" + (' is-invalid' if form.land_ownership.errors else '')) }}
                                {% if form.land_ownership.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.land_ownership.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                {{ form.land_size.label(class="form-label") }}
                                {{ form.land_size(class="form-control" + (' is-invalid' if form.land_size.errors else '')) }}
                                {% if form.land_size.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.land_size.errors[0] }}
                                    </div>
                                {% endif %}
                                <div class="form-text">Leave 0 if landless</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                {{ form.annual_income.label(class="form-label") }}
                                {{ form.annual_income(class="form-control" + (' is-invalid' if form.annual_income.errors else '')) }}
                                {% if form.annual_income.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.annual_income.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mt-4 text-success">Additional Information</h5>
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="form-group">
                                {{ form.caste_category.label(class="form-label") }}
                                {{ form.caste_category(class="form-select" + (' is-invalid' if form.caste_category.errors else '')) }}
                                {% if form.caste_category.errors %}
                                    <div class="invalid-feedback">
                                        {{ form.caste_category.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label d-block">Bank Account *</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="bank_account" id="bank_yes" 
                                           value="yes" {% if form.bank_account.data == 'yes' %}checked{% endif %} required>
                                    <label class="form-check-label" for="bank_yes">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="bank_account" id="bank_no" 
                                           value="no" {% if form.bank_account.data == 'no' %}checked{% endif %}>
                                    <label class="form-check-label" for="bank_no">No</label>
                                </div>
                                {% if form.bank_account.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.bank_account.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label d-block">Aadhaar Linked to Bank? *</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="aadhaar_linked" id="aadhaar_yes" 
                                           value="yes" {% if form.aadhaar_linked.data == 'yes' %}checked{% endif %} required>
                                    <label class="form-check-label" for="aadhaar_yes">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="aadhaar_linked" id="aadhaar_no" 
                                           value="no" {% if form.aadhaar_linked.data == 'no' %}checked{% endif %}>
                                    <label class="form-check-label" for="aadhaar_no">No</label>
                                </div>
                                {% if form.aadhaar_linked.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.aadhaar_linked.errors[0] }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <button type="reset" class="btn btn-outline-secondary me-md-2">Reset</button>
                        <button type="submit" class="btn btn-success">Check Eligibility</button>
                    </div>
                </form>
                
                {% if result and eligible_schemes %}
                <div class="mt-5">
                    <h3 class="text-success mb-4">Eligible Government Schemes</h3>
                    <div class="row">
                        {% for scheme in eligible_schemes %}
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 border-success">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">{{ scheme.name }}</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">{{ scheme.description }}</p>
                                    <h6>Benefits:</h6>
                                    <p>{{ scheme.benefits }}</p>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <a href="{{ scheme.website }}" target="_blank" class="btn btn-outline-success">
                                        Learn More & Apply <i class="bi bi-box-arrow-up-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% elif result and not eligible_schemes %}
                <div class="alert alert-warning mt-4">
                    <h4 class="alert-heading">No Schemes Found</h4>
                    <p>Based on the information provided, you may not be eligible for any government schemes at this time.</p>
                    <hr>
                    <p class="mb-0">Please check back later or contact your local agriculture office for more information.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
// Enable form validation
(function () {
    'use strict'
    
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.querySelectorAll('.needs-validation')
    
    // Loop over them and prevent submission
    Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                
                form.classList.add('was-validated')
            }, false)
        })
})()

// Dynamic district loading based on state (placeholder - in a real app, this would be an API call)
document.getElementById('state')?.addEventListener('change', function() {
    const state = this.value;
    const districtInput = document.getElementById('district');
    
    // In a real application, you would fetch districts for the selected state from an API
    // For now, we'll just clear the district field
    if (state && districtInput) {
        districtInput.value = '';
        districtInput.placeholder = 'Enter your district';
    }
});
</script>
{% endblock %}

{% endblock %}
